# integrate-nestjs-with-external-services-using-microservice-transporters

## P1 Introduction to Microservices and Transporters

### 介绍

这篇文章系列介绍了如何将 NestJS 应用程序与其他应用程序和服务集成的主题。这可以通过几种不同的方式来实现；本系列中介绍的方法是使用 Nest 微服务和消息代理作为粘合剂的组合。换句话说，Nest 应用程序和外部应用程序通过消息代理异步相互通信。

在这些示例中，我们使用 NATS 作为消息代理。注意：这里的一些概念是所有 Nest 微服务传输器通用的，而其他一些则是特定于 NATS 的。我试图在文本中标识出这些差异。

### 源代码
<https://github.com/johnbiundo/nest-nats-sample>

### Nest 中 Microservices 的背景

Nest 的微服务包是那些可能有点难以理解的技术之一。并不是说它过于复杂——相反，它提供了一种非常简单的应用程序编程模型。我认为困惑来自于“微服务”这个术语的使用，它已经被过度使用到几乎毫无意义，以及 Nest 的微服务包支持几种相当不同的用例：

- 在内部用作传输层，开发人员需要了解的表面级别之外几乎没有什么可以有效地使用它。它只是“工作”，并提供一种机制来向 Nest 应用程序添加可扩展性和容错等功能。
- 用作集成技术，需要更深入地挖掘。由于微服务包扮演着这种双重角色，因此在将其用于集成时，会出现重要的实现细节，并且可能会妨碍它。幸运的是，通常情况下，Nest 架构的优雅提供了使这个用例成为可能的机制（如果不是很明显的话）。本主题是本系列文章的重点。

接下来的几篇文章 将会一一介绍其的基本原理，为了达到这个目的，我们会先介绍一些 Nest 微服务的基础知识。即使您使用该包进行上述第一个用例（Nest 应用程序之间的通信层）中描述的操作，其中一些基础知识也可能对您有所帮助。您可以跳过基础知识，或者如果您想稍后再回来参考，您可以只阅读您需要的部分。

• 第1部分（本文！）涵盖了介绍性材料，包括基本的微服务通信模型、代理以及 Nest 如何使用发布/订阅和请求/响应通信模型。它介绍了将在本系列中涵盖的外部集成用例。它还为描述这些有时复杂的交互中所有移动部件提供了一个词汇表。
• 第2部分深入挖掘，扩展词汇表以描述 Nest 在与外部系统交互时的操作方式。它介绍了一对简单的外部（非 Nest，基于 NATS）应用程序，我们将在集成案例研究中使用它们。它介绍了 Nest 使用专有消息格式可能带来的挑战。
• 第3部分描述了 Nest 解决消息格式挑战的方法。接下来，它通过代码示例实现这种方法。它使用前面介绍的词汇表来帮助您在解决这个问题时保持简单的认知模型。
• 第4部分（即将推出）涵盖了一些剩余内容、一些高级用例以及一些技巧和窍门。

### 1-聊聊 Nest 中的 Transporters

NestJS 自带一个通用的网络通信子系统，称为“微服务”（microservices）。这可能有点令人困惑，但 Nest 微服务的核心、也是理解它们的关键是什么 Nest 称为传输器（transporters）。传输器使用可插拔的通信层和非常简单的应用层消息协议，使您能够在网络上连接组件。Nest 提供了多种传输器，同时还提供了一个 API，允许开发人员构建新的自定义传输器。这种架构和功能的组合非常强大。

一个内置的 Nest 传输器的具体例子是 NATS。使用 NATS-flavored 传输器，Nest 应用程序可以使用 NATS 消息系统进行通信。由于 NATS 是这些通信的中介，Nest 不仅可以与其他 Nest 应用程序通信，还可以与非 Nest 应用程序通信，或者两者结合。这导致了四个有趣的用例（如下图一所示）。

<img src="https://res.cloudinary.com/practicaldev/image/fetch/s--5B0are4M--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/johnbiundo/dev.to-articles/master/blog-posts/micro-nats-1/assets/transporter-use-cases.png"/>


